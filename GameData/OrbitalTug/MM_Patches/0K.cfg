// correct node orientation
@PART[adaptorCarrier,fwdAdaptor]:NEEDS[OrbitalTug]:After[OrbitalTug]
{
	@node_stack_mid = 	0.0, -0.01, 0.0, 	0.0, 1.0, 0.0, 1 
}
// zer0Kerbal

// change node size from 2 to 1 to match rest of parts
@PART[OrbitalTugCore]:NEEDS[OrbitalTug]:After[OrbitalTug]
{
   @node_stack_top = 0, 0.76, 0, 0, 1, 0, 1
   @node_stack_bottom = 0, -0.76, 0, 0, -1, 0, 1
}
// zer0Kerbal
	
@PART[fwdAdaptor,adaptorCarrier]:NEEDS[OrbitalTug]:After[OrbitalTug]
{	
	@RESOURCE[MonoPropellant]
	{
		%amount = 160
		%maxAmount = 160
	}
}
// zer0Kerbal

// IF present, add CCK tag and Editor Categorgy
@CCKExtraFilterConfig:NEEDS[CCK,OrbitalTug]
{
   Item 
   {
      name = Orbital Tug
      tag = cck-ot
      normalIcon = OrbitalTug/Textures/FilterIcon
      selectedIcon = OrbitalTug/Textures/FilterIcon_Selected
      usedByMod = OrbitalTug
   }
}

@PART[adaptorCarrier,fwdAdaptor,OrbitalTugCore,OrbitalTugPod,helperDrone,DronePod,OrbitalGrapplerJR,engineOnArm]:NEEDS[CCK,OrbitalTug]
{
   @tags ^= :^:cck-ot
}
// zer0Kerbal

// IF Restock present, adjust lights to use Restock Light Module
@PART[OrbitalTugPod,helperDrone,DronePod,OrbitalGrapplerJR]:NEEDS[OrbitalTug]
{
   @MODULE[ModuleLight]:NEEDS[!ReStock]
   {
      @name = ModuleStockLightColoredLens
      %lightR = 1.0
      %lightG = 0.9
      %lightB = 0.8
      lensBrightness = 0.6
   }
   @MODULE[ModuleLight]:NEEDS[ReStock]
   {
      @name = ModuleColoredLensLight
      %lightR = 1.0
      %lightG = 0.9
      %lightB = 0.8
      lensBrightness = 0.6
   }
}
// zer0Kerbal

// Correct KAS
@PART[OrbitalTugPod]:NEEDS[OrbitalTug,KAS]:Final
{
	MODEL
	{
		model = OrbitalTug/pod/widgets/OUVWinch
		texture = fwdAdaptor, OrbitalTug/adaptor/fwdAdaptor
		scale = 0.9,0.9,0.9
		position = 0,0.85,0.18
		rotation = -90,0,0
	}
	
	MODEL
	{
		model = KAS/Models/CommonConnector/Connector
	}
	
	node_stack_front = 0.0, 1.11, 0.2258241, 0.0, 1.0, 0.0, 0  //node_stack_top
	
	// Remove old KAS 
	!MODULE[KASModuleWinch] {}
	!MODULE[ModuleKISPartMount] {}
	
	MODULE
	{
		name = KASLinkWinch

		// AbstractLinkPeer
		linkType = MdCable
		linkTypeDisplayName = #kasLOC_99004 // #kasLOC_99004 = Cable-35
		attachNodeName = front
		allowCoupling = true

		// KASLinkSourceBase
		jointName = mediumCableJoint
		linkRendererName = mediumCableRenderer
		coupleMode = NeverCouple

		// KASLinkSourcePhysical
		connectorMass = 0.01
		connectorInteractDistance = 0.5
		decoupleIncompatibleTargets = true
		sndPathLockConnector = KAS/Sounds/winchSmallLock
		sndPathDockConnector = KAS/Sounds/plugdocked
		sndPathGrabConnector = KAS/Sounds/grab
		sndPathPlugConnector = KAS/Sounds/plug
		sndPathUnplugConnector = KAS/Sounds/unplug
		sndPathBroke = KAS/Sounds/broke

		// KASLinkWinch
		connectorLockMaxErrorDist = 0.12 // Meters.
		connectorLockMaxErrorDir = 25 // Degrees.

		motorMaxSpeed = 3 // Meters per second.
		motorAcceleration = 0.4 // Meters per second per second.
		motorPowerDrain = 0.5 //0.7 // Units per second.

		sndPathMotor = KAS/Sounds/winchSmallMotor
		sndPathMotorStart = KAS/Sounds/winchSmallMotorStart
		sndPathMotorStop = KAS/Sounds/winchSmallMotorStop
	}
	MODULE
	{
		name = KASRendererPipe

		// KASRendererPipe
		rendererName = mediumCableRenderer
		pipeTextureRescaleMode = TileFromTarget
		pipeDiameter = 0.035
		pipeTexturePath = KAS/Textures/ProceduralSteelCable
		pipeNormalsTexturePath = KAS/Textures/ProceduralSteelCableNRM
		pipeTextureSamplesPerMeter = 10

		sourceJoint
		{
			sphereOffset = -0.1490
		}
		targetJoint
		{
			sphereDiameter = 0.035
			model = *CommonConnector*/head
			modelPartAttachAt = 0.0, 0.0, 0.0,  0, 0, 0 	// 0.0, 0.0, 0.0,  180, 0, 0
			modelPipeAttachAt = 0,0, 0.15,  0, 0, 0			// 0,0, 0.15,  0, 0, 0
			parkAttachAt = 0.05, 0.01, -0.11,  0, 0, 0	// -0.155, 0.0, -0.0792,  180, 0, 0
		}
	}
	MODULE
	{
		name = KASJointCableBase

		// AbstractJoint
		jointName = mediumCableJoint
		anchorAtSource = 0, 0, -0.1490
		anchorAtTarget = 0, 0, 0.1490
		maxLinkLength = 80
		linkBreakForce = 400

		// KASJointCableBase
		cableSpringForce = 2000
		cableSpringDamper = 1
	}
}
// zer0Kerbal
